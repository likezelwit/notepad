<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Garden Notepad â€” Zeli's Garden v4 FIX</title>

<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
  --green:#8ecf9a;
  --paper:#fffaf0;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Quicksand',sans-serif;
  background:linear-gradient(#e6f9ff,#dff9e6);
  height:100vh;
  overflow:hidden;
}
.app{height:100%;display:flex;flex-direction:column}
.header{padding:15px;display:flex;gap:10px;align-items:center}
.logo{background:var(--green);color:#fff;border-radius:10px;width:40px;height:40px;display:flex;align-items:center;justify-content:center}
.notes-list-view{
  flex:1;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:15px;
  padding:15px;
  overflow:auto;
}
.note-card{
  background:#fff;
  border-radius:14px;
  padding:12px;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
  position:relative;
}
.add-btn-card{
  border:2px dashed var(--green);
  text-align:center;
  color:var(--green);
}
.delete-card-btn{
  position:absolute;
  top:8px;
  right:8px;
  border:none;
  background:#fff;
  border-radius:50%;
  cursor:pointer;
}
.editor-view{
  position:fixed;
  inset:0;
  background:#eef5ee;
  display:none;
  flex-direction:column;
}
.editor-view.active{display:flex}
.editor-topbar{
  display:flex;
  gap:8px;
  align-items:center;
  padding:10px;
  background:#fff;
}
.note-title-input{
  flex:1;
  border:none;
  font-size:18px;
  outline:none;
}
.top-toolbar{
  display:flex;
  gap:8px;
  padding:8px;
  background:#fff;
}
.tool-btn{
  width:38px;height:38px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.editor-workspace{
  flex:1;
  overflow:auto;
  display:flex;
  justify-content:center;
  padding:20px;
}
.paper{
  background:var(--paper);
  width:800px;
  min-height:1100px;
  padding:40px;
  position:relative;
}
.rich-editor{
  min-height:900px;
  outline:none;
}
.sticker{
  position:absolute;
  cursor:grab;
  font-size:40px;
}
.page-nav{
  position:fixed;
  bottom:20px;
  right:20px;
  display:flex;
  gap:6px;
  background:#fff;
  padding:8px 12px;
  border-radius:20px;
}
.page-btn{
  width:34px;height:34px;
  border-radius:50%;
  border:1px solid #ccc;
  background:#fff;
  cursor:pointer;
}
.page-btn.active{
  background:var(--green);
  color:#fff;
  border-color:var(--green);
}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <div class="logo">ðŸŒ¿</div>
    <div>
      <b>Zeli's Garden</b>
      <div style="font-size:12px;color:#666">v4 FIX</div>
    </div>
  </div>

  <div class="notes-list-view" id="notesList"></div>
</div>

<div class="editor-view" id="editorView">
  <div class="editor-topbar">
    <button class="tool-btn" id="backBtn"><i class="fas fa-arrow-left"></i></button>
    <input id="noteTitle" class="note-title-input" placeholder="Judul...">
    <span id="saveIndicator" style="font-size:11px;color:var(--green)"></span>
  </div>

  <div class="top-toolbar">
    <button class="tool-btn" onclick="execCmd('bold')"><i class="fas fa-bold"></i></button>
    <button class="tool-btn" onclick="execCmd('italic')"><i class="fas fa-italic"></i></button>
    <button class="tool-btn" onclick="addSticker('ðŸŒ¸')">ðŸŒ¸</button>
    <button class="tool-btn" onclick="addSticker('ðŸ¦‹')">ðŸ¦‹</button>
  </div>

  <div class="editor-workspace">
    <div class="paper" id="paper">
      <div id="editor" class="rich-editor" contenteditable="true"></div>
    </div>
  </div>

  <div class="page-nav" id="pageNav"></div>
</div>

<script>
/* =======================
   STATE
======================= */
const NOTES_KEY='zeli_garden_v4_fixed';
let notes=JSON.parse(localStorage.getItem(NOTES_KEY)||'[]');
let currentNote=null;
let currentPage=1;

/* =======================
   HELPERS
======================= */
const $=id=>document.getElementById(id);

/* =======================
   LIST
======================= */
function renderList(){
  const list=$('notesList');
  list.innerHTML='';
  const add=document.createElement('div');
  add.className='note-card add-btn-card';
  add.innerHTML='<b>ï¼‹ New Note</b>';
  add.onclick=createNote;
  list.appendChild(add);

  notes.forEach(n=>{
    const c=document.createElement('div');
    c.className='note-card';
    c.innerHTML=`
      <b>${n.title||'Tanpa Judul'}</b>
      <div style="font-size:12px;color:#666">${new Date(n.updatedAt).toLocaleDateString()}</div>
      <button class="delete-card-btn"><i class="fas fa-times"></i></button>
    `;
    c.onclick=()=>openNote(n.id);
    c.querySelector('button').onclick=e=>{
      e.stopPropagation();
      deleteNote(n.id);
    };
    list.appendChild(c);
  });
}

/* =======================
   NOTE CRUD
======================= */
function createNote(){
  currentNote={
    id:Date.now().toString(),
    title:'',
    pages:1,
    content:{1:''},
    stickers:[],
    updatedAt:Date.now()
  };
  openEditor();
}

function openNote(id){
  currentNote=notes.find(n=>n.id===id);
  openEditor();
}

function deleteNote(id){
  if(confirm('Hapus catatan?')){
    notes=notes.filter(n=>n.id!==id);
    saveNotes();
    renderList();
  }
}

/* =======================
   EDITOR
======================= */
function openEditor(){
  $('editorView').classList.add('active');
  $('noteTitle').value=currentNote.title||'';
  currentPage=1;
  loadPage();
  updatePageNav();
}

$('backBtn').onclick=()=>{
  savePage();
  saveNote();
  $('editorView').classList.remove('active');
  renderList();
};

$('editor').addEventListener('input',()=>{
  savePage();
  autoSave();
});

$('noteTitle').addEventListener('input',autoSave);

function execCmd(cmd){
  document.execCommand(cmd);
}

/* =======================
   PAGE SYSTEM
======================= */
function loadPage(){
  $('editor').innerHTML=currentNote.content[currentPage]||'';
  document.querySelectorAll('.sticker').forEach(s=>{
    s.style.display=(+s.dataset.page===currentPage)?'block':'none';
  });
}

function savePage(){
  currentNote.content[currentPage]=$('editor').innerHTML;
}

function updatePageNav(){
  const nav=$('pageNav');
  nav.innerHTML='';
  for(let i=1;i<=currentNote.pages;i++){
    const b=document.createElement('button');
    b.className='page-btn'+(i===currentPage?' active':'');
    b.textContent=i;
    b.onclick=()=>{
      savePage();
      currentPage=i;
      loadPage();
      updatePageNav();
    };
    nav.appendChild(b);
  }
  const add=document.createElement('button');
  add.className='page-btn';
  add.innerHTML='ï¼‹';
  add.onclick=()=>{
    savePage();
    currentNote.pages++;
    currentPage=currentNote.pages;
    currentNote.content[currentPage]='';
    updatePageNav();
    loadPage();
  };
  nav.appendChild(add);
}

/* =======================
   STICKERS
======================= */
function addSticker(emoji){
  const s=document.createElement('div');
  s.className='sticker';
  s.textContent=emoji;
  s.style.left='100px';
  s.style.top='100px';
  s.dataset.page=currentPage;
  $('paper').appendChild(s);

  let ox,oy;
  s.onmousedown=e=>{
    ox=e.offsetX; oy=e.offsetY;
    document.onmousemove=m=>{
      s.style.left=m.pageX-ox+'px';
      s.style.top=m.pageY-oy+'px';
    };
    document.onmouseup=()=>document.onmousemove=null;
  };
}

/* =======================
   SAVE
======================= */
function autoSave(){
  currentNote.updatedAt=Date.now();
  $('saveIndicator').textContent='disimpan...';
  setTimeout(()=>$('saveIndicator').textContent='',800);
}

function saveNote(){
  savePage();
  currentNote.title=$('noteTitle').value;
  const i=notes.findIndex(n=>n.id===currentNote.id);
  if(i>-1) notes[i]=currentNote;
  else notes.unshift(currentNote);
  saveNotes();
}

function saveNotes(){
  localStorage.setItem(NOTES_KEY,JSON.stringify(notes));
}

/* =======================
   INIT
======================= */
renderList();
</script>
</body>
</html>
