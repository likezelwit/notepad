<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Zeli's Garden v5 ‚Äî Estetika & Emosi</title>
  
  <!-- Fonts Google -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;600&family=Poppins:wght@300;400&family=Nunito:wght@400;700&family=Baloo+2&family=Comic+Neue&family=Inter:wght@300;400&family=Caveat:wght@400;700&family=Kalam&family=Gloria+Hallelujah&family=Reenie+Beanie&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Libraries -->
  <script src="https://unpkg.com/picmo@latest/dist/umd/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/openmoji@14.0.0/dist/openmoji.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root{
      --sky-1: #e6f9ff;
      --sky-2: #cfeefd;
      --green-1: #f0fbf2;
      --green-2: #dff9e6;
      --green-3: #8ecf9a;
      --accent: #ffd6e0;
      --card: rgba(255,255,255,0.95);
      --muted: #6b6b6b;
      --paper-bg: #fffaf0;
      --paper-line: rgba(0,0,0,0.05);
      --font-main: 'Quicksand', sans-serif;
    }

    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    html,body{height:100%; margin:0; font-family:'Quicksand',sans-serif; overflow: hidden; touch-action: pan-y;}

    body{
      background: linear-gradient(180deg,var(--sky-1),var(--sky-2) 40%,var(--green-1) 60%,var(--green-2));
      display:flex; flex-direction: column;
    }

    /* --- UTILS --- */
    .hidden { display: none !important; }
    
    /* --- MODE SELECTION --- */
    .mode-selection {
      position: fixed; inset: 0; background: rgba(255,255,255,0.98);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 2000; padding: 20px;
    }
    .mode-options { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
    .mode-option {
      width: 140px; height: 140px; border-radius: 20px; background: white; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; 
      align-items: center; justify-content: center; cursor: pointer; transition: 0.3s;
    }
    .mode-option:hover { transform: translateY(-5px); }

    /* --- APP LAYOUT --- */
    .app {
      width:100%; height:100%; position:relative; 
      background: rgba(255,255,255,0.5); backdrop-filter: blur(5px);
      display: flex; flex-direction: column;
    }

    .header{
      flex: 0 0 70px; padding:0 15px; display:flex; align-items:center; gap:10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.0));
      z-index: 10;
    }
    .logo{
      width:40px; height:40px; border-radius:12px; 
      background: linear-gradient(135deg, var(--green-3), var(--green-2));
      display:flex; align-items:center; justify-content:center; 
      font-size:20px; color:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.1);
    }
    
    /* Search Bar */
    .search-container { flex: 1; position: relative; }
    .search-input {
      width: 100%; padding: 10px 15px 10px 35px; border-radius: 20px;
      border: 1px solid rgba(0,0,0,0.1); background: rgba(255,255,255,0.8);
      font-family: inherit; font-size: 14px; outline: none;
      transition: 0.3s;
    }
    .search-input:focus { background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999; font-size: 12px; }

    /* Ambient Button */
    .ambient-btn {
      width: 40px; height: 40px; border-radius: 50%; border: none;
      background: white; color: var(--green-3); cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center;
      position: relative;
    }
    .ambient-btn.active { background: var(--accent); color: white; animation: pulse 2s infinite; }
    @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(255, 214, 224, 0.7);} 70% {box-shadow: 0 0 0 10px rgba(255, 214, 224, 0);} 100% {box-shadow: 0 0 0 0 rgba(255, 214, 224, 0);} }

    /* --- LIST VIEW --- */
    .notes-list-view {
      flex: 1; overflow-y: auto; padding: 20px;
      display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px;
      padding-bottom: 100px;
    }
    .note-card {
      background: var(--card); border-radius: 16px; padding: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.03); cursor: pointer;
      display: flex; flex-direction: column; height: 180px; position: relative;
      transition: all 0.2s; border: 1px solid rgba(255,255,255,0.5);
    }
    .note-card:hover { transform: translateY(-3px); }
    .note-tag {
      width: 12px; height: 12px; border-radius: 50%; position: absolute; top: 15px; right: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .note-lock-icon {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 40px; color: rgba(0,0,0,0.05); pointer-events: none;
    }
    
    .add-btn-card {
      border: 2px dashed var(--green-3); background: rgba(255,255,255,0.4);
      color: var(--green-3); display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    /* --- EDITOR VIEW --- */
    .editor-view {
      position: fixed; inset: 0; background: #f4f9f4;
      display: flex; flex-direction: column;
      transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 50;
    }
    .editor-view.active { transform: translateX(0); }
    
    .editor-topbar {
      flex: 0 0 60px; padding: 0 10px; display: flex; align-items: center; gap: 10px;
      background: white; border-bottom: 1px solid #eee; z-index: 20;
    }
    .note-title-input { flex: 1; border: none; font-size: 18px; font-weight: 600; outline: none; background: transparent; }

    /* Workspace */
    .editor-workspace {
      flex: 1; position: relative; overflow-y: auto; overflow-x: hidden;
      display: flex; justify-content: center; background: #eef5ee;
      padding: 80px 20px 100px;
    }
    .paper-container {
      width: 100%; height: 1760px; position: relative;
      background: var(--paper-bg); box-shadow: 0 5px 25px rgba(0,0,0,0.05);
      border-radius: 8px; max-width: 800px; overflow: hidden;
    }
    
    /* Drawing Layer */
    .drawing-layer {
      position: absolute; inset: 0; z-index: 8; pointer-events: none;
      touch-action: none;
    }
    .paper-container.drawing-active .drawing-layer { pointer-events: auto; cursor: crosshair; }
    
    .sticker-layer { position: absolute; inset: 0; overflow: hidden; pointer-events: none; }
    .sticker-layer.front { z-index: 10; } 
    .sticker-layer.back { z-index: 1; }

    .rich-editor {
      position: relative; width: 100%; height: 100%; padding: 40px;
      font-size: 16px; line-height: 2; z-index: 5; outline: none;
    }
    .paper-container.arrange-mode .rich-editor { pointer-events: none; opacity: 0.6; }

    /* --- TOOLBARS --- */
    .top-toolbar-container {
      position: absolute; top: 60px; left: 0; width: 100%;
      background: rgba(255,255,255,0.95); padding: 10px 15px;
      display: flex; align-items: center; justify-content: space-between;
      backdrop-filter: blur(10px); z-index: 100; border-bottom: 1px solid #eee;
    }
    .scroll-tools { display: flex; align-items: center; gap: 10px; overflow-x: auto; flex: 1; padding-right: 10px; }
    .scroll-tools::-webkit-scrollbar { display: none; }
    
    .tool-btn {
      flex: 0 0 40px; width: 40px; height: 40px; border-radius: 10px;
      border: none; background: #f4f6f4; color: #555; font-size: 16px;
      display: flex; align-items: center; justify-content: center; cursor: pointer;
    }
    .tool-btn.active { background: var(--green-3); color: white; }
    .tool-btn.draw-active { background: #ff9800; color: white; }

    /* --- MODALS --- */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 3000;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: 0.3s;
    }
    .modal-overlay.active { opacity: 1; pointer-events: auto; }
    .modal-box {
      background: white; width: 90%; max-width: 320px; border-radius: 20px; padding: 25px;
      text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: popUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
    }
    @keyframes popUp { from {transform: scale(0.8); opacity:0;} to {transform: scale(1); opacity:1;} }
    
    .pin-display {
      font-size: 30px; letter-spacing: 15px; margin: 20px 0; font-weight: bold; min-height: 40px; color: #333;
    }
    .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
    .num-btn {
      padding: 15px; border-radius: 50%; background: #f8f9fa; border: 1px solid #eee;
      font-size: 18px; font-weight: bold; cursor: pointer; color: #555;
    }
    .num-btn:active { background: var(--green-3); color: white; }

    /* --- MEGA PANEL --- */
    .mega-panel {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 60vh;
      background: white; border-radius: 25px 25px 0 0;
      box-shadow: 0 -10px 40px rgba(0,0,0,0.15); z-index: 200;
      transform: translateY(110%); transition: transform 0.3s; display: flex; flex-direction: column;
    }
    .mega-panel.open { transform: translateY(0); }
    .panel-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items:center; }
    .panel-content { flex: 1; overflow-y: auto; padding: 20px; }
    .panel-tabs { display:flex; gap:10px; padding:10px 15px; border-bottom:1px solid #eee; overflow-x:auto; }
    .tab-btn { padding:5px 12px; border-radius:15px; border:1px solid #eee; background:white; white-space:nowrap; cursor:pointer;}
    .tab-btn.active { background:var(--green-2); color:var(--green-3); border-color:var(--green-3); font-weight:bold; }
    
    .tool-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
    .tool-item {
      display: flex; flex-direction: column; align-items: center; gap: 8px; 
      padding: 15px 5px; background: #f8f9fa; border-radius: 12px; cursor: pointer; text-align: center;
    }
    .tool-item span { font-size: 11px; }

    /* Ambient Menu */
    .ambient-menu {
      position: absolute; top: 70px; right: 20px; background: white;
      border-radius: 15px; padding: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      z-index: 1000; width: 180px;
    }
    .ambient-option {
      display: flex; align-items: center; gap: 10px; padding: 10px;
      border-radius: 8px; cursor: pointer; font-size: 14px;
    }
    .ambient-option:hover { background: #f0f0f0; }
    .ambient-option.active { color: var(--green-3); font-weight: bold; background: var(--green-1); }

    /* Stickers */
    .sticker { position: absolute; display: inline-flex; cursor: grab; user-select: none; }
    .sticker-controls { display: none; position: absolute; inset: -15px; border: 2px dashed #ccc; border-radius: 8px; pointer-events: none; }
    .sticker.selected .sticker-controls { display: block; }
    .ctrl-btn { pointer-events: auto; position: absolute; width: 24px; height: 24px; background: white; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; }
    .ctrl-del { top: -12px; right: -12px; color: red; }
    .ctrl-move { top: -12px; left: 50%; transform: translateX(-50%); color: blue; cursor: move; }
    .ctrl-rotate { bottom: -12px; right: -12px; color: green; cursor: ew-resize; }

    #emojiContainer { width: 100%; height: 100%; }
    .picmo__picker { width: 100% !important; border: none !important; }

    /* Responsive */
    @media(min-width: 600px) {
      .mega-panel { width: 400px; left: 50%; transform: translate(-50%, 110%); bottom: 20px; border-radius: 15px; }
      .mega-panel.open { transform: translate(-50%, 0); }
      .top-toolbar-container { width: 600px; left: 50%; transform: translateX(-50%); border-radius: 0 0 16px 16px; }
    }
    @media(max-width: 767px) {
      .top-toolbar-container { position: fixed; bottom: 0; top: auto; border-radius: 20px 20px 0 0; padding-bottom: 20px; }
      .editor-workspace { padding-bottom: 120px; }
    }
  </style>
</head>
<body>

<!-- Mode Selection -->
<div class="mode-selection" id="modeSelection">
  <h2>üåø Zeli's Garden v5</h2>
  <p style="color:#666; margin-top:5px; text-align:center;">Sekarang dengan Musik, Menggambar,<br>dan Kunci Rahasia!</p>
  <div class="mode-options">
    <div class="mode-option" onclick="selectMode('desktop')">
      <i class="fas fa-desktop" style="font-size:40px; margin-bottom:10px;"></i>
      <span>Desktop</span>
    </div>
    <div class="mode-option" onclick="selectMode('mobile')">
      <i class="fas fa-mobile-alt" style="font-size:40px; margin-bottom:10px;"></i>
      <span>Mobile</span>
    </div>
  </div>
</div>

<!-- List View -->
<div class="app">
  <div class="header">
    <div class="logo">üåø</div>
    <div class="search-container">
      <i class="fas fa-search search-icon"></i>
      <input type="text" class="search-input" id="searchInput" placeholder="Cari catatan...">
    </div>
    <button class="ambient-btn" id="ambientToggle" title="Musik Latar">
      <i class="fas fa-music"></i>
    </button>
  </div>

  <div class="ambient-menu hidden" id="ambientMenu">
    <div class="ambient-option" onclick="playAmbient('rain')"><i class="fas fa-cloud-rain"></i> Hujan</div>
    <div class="ambient-option" onclick="playAmbient('lofi')"><i class="fas fa-coffee"></i> Lo-Fi</div>
    <div class="ambient-option" onclick="playAmbient('forest')"><i class="fas fa-tree"></i> Hutan</div>
    <hr style="border:0; border-top:1px solid #eee; margin:5px 0;">
    <div class="ambient-option" onclick="stopAmbient()"><i class="fas fa-stop"></i> Matikan</div>
  </div>

  <div class="notes-list-view" id="notesList"></div>
  
  <button class="tool-btn" style="position:absolute; bottom:20px; right:20px; width:55px; height:55px; background:#ff9800; color:white; border-radius:50%; box-shadow:0 4px 15px rgba(0,0,0,0.2); font-size:20px;" onclick="showExportDialog('all')" title="Backup Semua">
    <i class="fas fa-download"></i>
  </button>
  <button class="tool-btn" style="position:absolute; bottom:85px; right:20px; width:55px; height:55px; background:#4D89FF; color:white; border-radius:50%; box-shadow:0 4px 15px rgba(0,0,0,0.2); font-size:20px;" onclick="$('importFileInput').click()" title="Import">
    <i class="fas fa-upload"></i>
  </button>
</div>

<!-- Editor View -->
<div class="editor-view" id="editorView">
  <div class="editor-topbar">
    <button class="tool-btn" onclick="closeEditor()"><i class="fas fa-arrow-left"></i></button>
    <input type="text" class="note-title-input" id="noteTitle" placeholder="Judul...">
    <div id="saveIndicator" style="font-size:10px; color:var(--green-3); font-weight:bold; white-space:nowrap;"></div>
    <button class="tool-btn" onclick="showExportDialog('single')"><i class="fas fa-download"></i></button>
  </div>

  <div class="top-toolbar-container">
    <div class="scroll-tools">
      <button class="tool-btn" onclick="addNewPage()"><i class="fas fa-plus"></i></button>
      <div style="width:1px; height:20px; background:#ddd; margin:0 5px;"></div>
      <button class="tool-btn active" id="modeBtn" onclick="toggleEditMode()"><i class="fas fa-pen"></i></button>
      <button class="tool-btn" id="drawBtn" onclick="toggleDrawingMode()"><i class="fas fa-paint-brush"></i></button>
      <div style="width:1px; height:20px; background:#ddd; margin:0 5px;"></div>
      <button class="tool-btn" onclick="execCmd('bold')"><i class="fas fa-bold"></i></button>
      <button class="tool-btn" onclick="execCmd('italic')"><i class="fas fa-italic"></i></button>
      <button class="tool-btn" onclick="insertCheckbox()"><i class="far fa-check-square"></i></button>
      <button class="tool-btn" onclick="insertImagePrompt()"><i class="far fa-image"></i></button>
    </div>
    <button class="tool-btn" style="background:#333; color:white;" onclick="openPanel('stickers')"><i class="fas fa-bars"></i></button>
  </div>

  <div class="editor-workspace">
    <div class="paper-container" id="paperContainer">
      <canvas class="drawing-layer" id="drawingCanvas" width="800" height="1760"></canvas>
      <div class="paper-pattern" id="paperPattern" style="position:absolute; inset:0; background-image:repeating-linear-gradient(transparent, transparent 31px, rgba(0,0,0,0.05) 31px, rgba(0,0,0,0.05) 32px); background-size:100% 32px; pointer-events:none; z-index:0;"></div>
      <div class="sticker-layer back" id="stickerLayerBack"></div>
      <div class="rich-editor" id="richEditor" contenteditable="true" spellcheck="false" placeholder="Tulis cerita..."></div>
      <div class="sticker-layer front" id="stickerLayerFront"></div>
    </div>
    
    <div class="page-nav" id="pageNav" style="position:fixed; top:80px; right:20px; background:rgba(255,255,255,0.9); padding:5px 10px; border-radius:20px; display:flex; gap:5px; box-shadow:0 5px 15px rgba(0,0,0,0.1); z-index:100; display:none;">
       <button class="tool-btn" style="width:30px; height:30px;" onclick="navigatePage('prev')"><i class="fas fa-chevron-left"></i></button>
       <span id="pageIndicator" style="font-size:12px; font-weight:bold; padding:0 5px; align-self:center;">1</span>
       <button class="tool-btn" style="width:30px; height:30px;" onclick="navigatePage('next')"><i class="fas fa-chevron-right"></i></button>
    </div>
  </div>
</div>

<!-- Mega Panel -->
<div class="mega-panel" id="megaPanel">
  <div class="panel-header">
    <h3>Menu & Alat</h3>
    <button onclick="closePanel()" style="border:none; background:none; font-size:24px;">&times;</button>
  </div>
  <div class="panel-tabs">
    <button class="tab-btn active" data-tab="stickers" onclick="renderPanel('stickers')">Stiker</button>
    <button class="tab-btn" data-tab="stickers2" onclick="renderPanel('stickers2')">Custom</button>
    <button class="tab-btn" data-tab="style" onclick="renderPanel('style')">Gaya</button>
    <button class="tab-btn" data-tab="paper" onclick="renderPanel('paper')">Kertas</button>
    <button class="tab-btn" data-tab="meta" onclick="renderPanel('meta')">Kunci & Tag</button>
  </div>
  <div class="panel-content" id="panelContent"></div>
</div>

<!-- PIN Modal -->
<div class="modal-overlay" id="pinModal">
  <div class="modal-box">
    <h3 id="pinTitle">Masukkan PIN</h3>
    <div class="pin-display" id="pinDisplay"></div>
    <div class="numpad">
      <button class="num-btn" onclick="typePin(1)">1</button>
      <button class="num-btn" onclick="typePin(2)">2</button>
      <button class="num-btn" onclick="typePin(3)">3</button>
      <button class="num-btn" onclick="typePin(4)">4</button>
      <button class="num-btn" onclick="typePin(5)">5</button>
      <button class="num-btn" onclick="typePin(6)">6</button>
      <button class="num-btn" onclick="typePin(7)">7</button>
      <button class="num-btn" onclick="typePin(8)">8</button>
      <button class="num-btn" onclick="typePin(9)">9</button>
      <button class="num-btn" style="background:#ffebee; color:#d32f2f;" onclick="clearPin()">C</button>
      <button class="num-btn" onclick="typePin(0)">0</button>
      <button class="num-btn" style="background:#e8f5e9; color:#2e7d32;" onclick="submitPin()">OK</button>
    </div>
    <button onclick="closePinModal()" style="margin-top:15px; background:none; border:none; color:#666; text-decoration:underline;">Batal</button>
  </div>
</div>

<!-- Update Popup -->
<div class="modal-overlay" id="updateModal">
  <div class="modal-box">
    <div style="font-size:40px; margin-bottom:10px;">üéâ</div>
    <h3>Update Baru v5!</h3>
    <ul style="text-align:left; font-size:14px; color:#555; margin:15px 0; line-height:1.6; list-style:none; padding:0;">
      <li>üîç <b>Search Bar:</b> Cari catatan dengan mudah.</li>
      <li>üé® <b>Mode Gambar:</b> Coret-coret di atas kertas.</li>
      <li>üîí <b>Kunci PIN:</b> Amankan rahasiamu.</li>
      <li>üéµ <b>Musik:</b> Suara Hujan, Hutan & Lo-Fi.</li>
      <li>üè∑Ô∏è <b>Label Warna:</b> Tandai catatan penting.</li>
    </ul>
    <button class="tool-btn" style="width:100%; background:var(--green-3); color:white;" onclick="closeUpdateModal()">Keren!</button>
  </div>
</div>

<!-- Overlays -->
<div class="overlay" id="overlay" onclick="closePanel()"></div>
<input type="file" id="importFileInput" style="display:none" accept=".json">
<input type="file" id="customStickerInput" style="display:none" accept="image/*">

<!-- Audio Elements (Free Source URLs) -->
<audio id="bgmRain" loop><source src="https://cdn.pixabay.com/download/audio/2022/07/04/audio_b95d13735a.mp3" type="audio/mpeg"></audio>
<audio id="bgmLofi" loop><source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3" type="audio/mpeg"></audio>
<audio id="bgmForest" loop><source src="https://cdn.pixabay.com/download/audio/2021/09/06/audio_3828957802.mp3" type="audio/mpeg"></audio>

<!-- UI Sounds (Data URI) -->
<audio id="sfxClick" preload="auto"><source src="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAADhAAzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQKAAAAAAAAA4YJCGYZn///////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQKAAAAAAAAA4YJCGYZn///////////8=" type="audio/mpeg"></audio>

<script>
  // --- HELPERS ---
  const $ = id => document.getElementById(id);
  const evtPd = e => e.preventDefault();
  
  // --- STATE ---
  const NOTES_KEY = 'zeli_garden_v5';
  const MODE_KEY = 'zeli_garden_mode';
  const STICKER_KEY = 'zeli_custom_stickers';
  const VERSION_KEY = 'zeli_version';
  const CURRENT_VERSION = '5.0';
  
  let notes = JSON.parse(localStorage.getItem(NOTES_KEY) || '[]');
  let customStickers = JSON.parse(localStorage.getItem(STICKER_KEY) || '[]');
  let currentNote = null;
  let currentPage = 1;
  let isArrangeMode = false;
  let isDrawingMode = false;
  let isLoading = false;
  let autoSaveTimer = null;
  let selectedSticker = null;
  let savedRange = null;
  let emojiPicker = null;
  let currentPin = "";
  let tempPinAction = null; // 'open' or 'lock'
  let targetNoteId = null;
  let activeAudio = null;

  // Drawing State
  let canvas, ctx;
  let isDrawing = false;
  let lastX = 0, lastY = 0;

  // --- INIT ---
  window.addEventListener('DOMContentLoaded', () => {
    // Check Mode
    if(localStorage.getItem(MODE_KEY)) {
      $('modeSelection').classList.add('hidden');
      if(localStorage.getItem(MODE_KEY) === 'mobile') document.body.classList.add('mobile-mode');
      initApp();
    }
    
    // Check Update Popup
    if(localStorage.getItem(VERSION_KEY) !== CURRENT_VERSION) {
      $('updateModal').classList.add('active');
    }
  });

  function selectMode(m) {
    localStorage.setItem(MODE_KEY, m);
    $('modeSelection').classList.add('hidden');
    initApp();
  }

  function closeUpdateModal() {
    localStorage.setItem(VERSION_KEY, CURRENT_VERSION);
    $('updateModal').classList.remove('active');
  }

  function initApp() {
    renderList();
    initListeners();
    initCanvas();
  }

  function initListeners() {
    // Search
    $('searchInput').addEventListener('keyup', (e) => {
      renderList(e.target.value.toLowerCase());
    });

    // Ambient
    $('ambientToggle').addEventListener('click', () => {
      $('ambientMenu').classList.toggle('hidden');
    });

    // Editor Events
    $('richEditor').addEventListener('input', () => debounceAutoSave());
    $('noteTitle').addEventListener('input', () => debounceAutoSave());
    $('richEditor').addEventListener('blur', saveSelection);
    
    // Import/Export
    $('importFileInput').addEventListener('change', importNotes);
    $('customStickerInput').addEventListener('change', handleCustomStickerUpload);

    // Canvas Events
    canvas = $('drawingCanvas');
    ['mousedown', 'touchstart'].forEach(e => canvas.addEventListener(e, startDraw, {passive:false}));
    ['mousemove', 'touchmove'].forEach(e => canvas.addEventListener(e, draw, {passive:false}));
    ['mouseup', 'touchend'].forEach(e => canvas.addEventListener(e, stopDraw));
  }

  // --- LIST & SEARCH ---
  function renderList(searchTerm = '') {
    const list = $('notesList');
    list.innerHTML = '';
    
    // Add Button
    const addBtn = document.createElement('div');
    addBtn.className = 'note-card add-btn-card';
    addBtn.innerHTML = '<i class="fas fa-plus" style="font-size:30px; margin-bottom:10px;"></i><b>Baru</b>';
    addBtn.onclick = createNote;
    list.appendChild(addBtn);

    // Filter & Render
    const filtered = notes.filter(n => {
      const content = n.pages?.[1]?.content || n.content || '';
      return (n.title || '').toLowerCase().includes(searchTerm) || content.toLowerCase().includes(searchTerm);
    });

    filtered.forEach(n => {
      const card = document.createElement('div');
      card.className = 'note-card';
      const rawText = (n.pages?.[1]?.content || n.content || '').replace(/<[^>]*>?/gm, '');
      const prev = rawText.substring(0, 80) + '...';
      const tagColor = getTagColor(n.tag);

      card.innerHTML = `
        ${n.tag ? `<div class="note-tag" style="background:${tagColor}"></div>` : ''}
        ${n.isLocked ? `<i class="fas fa-lock note-lock-icon"></i>` : ''}
        <h3 style="margin:0 0 10px;font-size:15px;font-weight:bold;">${n.title || 'Tanpa Judul'}</h3>
        <p style="font-size:12px;color:#666;flex:1;overflow:hidden;line-height:1.4;">${n.isLocked ? 'üîí Catatan Terkunci' : prev}</p>
        <div style="font-size:10px;color:#999;margin-top:10px;display:flex;justify-content:space-between;">
          <span>${new Date(n.updatedAt).toLocaleDateString()}</span>
          <span>${n.mood || 'üåø'}</span>
        </div>
        <button style="position:absolute;top:10px;right:10px;border:none;background:white;width:24px;height:24px;border-radius:50%;color:#ff6b6b;box-shadow:0 2px 5px rgba(0,0,0,0.1);cursor:pointer;z-index:2;" onclick="deleteNote('${n.id}', event)">√ó</button>
      `;
      card.onclick = (e) => { if(!e.target.closest('button')) checkLockAndOpen(n); };
      list.appendChild(card);
    });
  }

  function getTagColor(tag) {
    if(tag === 'Penting') return '#ff6b6b';
    if(tag === 'Ide') return '#54a0ff';
    if(tag === 'Jurnal') return '#1dd1a1';
    return '#ccc';
  }

  // --- CORE NOTE FUNCTIONS ---
  function createNote() {
    isNewNote = true;
    currentNote = {
      id: Date.now().toString(),
      title: '', pages: { 1: { content: '', stickers: [], drawing: null } },
      createdAt: Date.now(), updatedAt: Date.now(),
      theme: 'default', paper: 'lines', isLocked: false, pin: null, tag: null
    };
    currentPage = 1;
    loadNoteData();
    $('editorView').classList.add('active');
    isArrangeMode = true; toggleEditMode();
  }

  function checkLockAndOpen(note) {
    if(note.isLocked) {
      targetNoteId = note.id;
      tempPinAction = 'open';
      $('pinTitle').innerText = "Masukkan PIN";
      openPinModal();
    } else {
      openNote(note);
    }
  }

  function openNote(note) {
    // Deep copy to avoid reference issues
    currentNote = JSON.parse(JSON.stringify(note));
    if(!currentNote.pages) currentNote.pages = { 1: { content: currentNote.content || '', stickers: currentNote.stickers || [] } };
    currentPage = 1;
    loadNoteData();
    $('editorView').classList.add('active');
    isArrangeMode = true; toggleEditMode();
  }

  function loadNoteData() {
    isLoading = true;
    // Reset UI
    $('stickerLayerBack').innerHTML = '';
    $('stickerLayerFront').innerHTML = '';
    $('richEditor').innerHTML = '';
    clearCanvas();

    // Fill Data
    $('noteTitle').value = currentNote.title || '';
    const p = currentNote.pages[currentPage] || { content: '', stickers: [] };
    $('richEditor').innerHTML = p.content;
    
    // Load Stickers
    if(p.stickers) p.stickers.forEach(renderSticker);
    
    // Load Drawing
    if(p.drawing) loadCanvas(p.drawing);
    
    // Update Page Nav
    const total = Object.keys(currentNote.pages).length;
    $('pageNav').style.display = total > 1 ? 'flex' : 'none';
    $('pageIndicator').innerText = `${currentPage} / ${total}`;

    // Styles
    applyTheme(currentNote.theme, false);
    applyPaper(currentNote.paper);

    setTimeout(() => isLoading = false, 100);
  }

  function autoSave() {
    if(isLoading || !currentNote || !$('editorView').classList.contains('active')) return;

    // Save current page state
    if(!currentNote.pages[currentPage]) currentNote.pages[currentPage] = {};
    const p = currentNote.pages[currentPage];
    
    p.content = $('richEditor').innerHTML;
    p.stickers = getStickersData();
    p.drawing = canvas.toDataURL(); // Save canvas data

    currentNote.title = $('noteTitle').value || 'Tanpa Judul';
    currentNote.updatedAt = Date.now();

    // Update Storage
    const idx = notes.findIndex(n => n.id === currentNote.id);
    if(idx > -1) notes[idx] = currentNote;
    else notes.unshift(currentNote);

    localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
    $('saveIndicator').innerText = 'Disimpan...';
    setTimeout(() => { if($('saveIndicator')) $('saveIndicator').innerText = ''; }, 2000);
  }

  function debounceAutoSave() {
    clearTimeout(autoSaveTimer);
    autoSaveTimer = setTimeout(autoSave, 1000);
  }

  function closeEditor() {
    clearTimeout(autoSaveTimer);
    autoSave(); // Force save
    $('editorView').classList.remove('active');
    setTimeout(() => {
        currentNote = null;
        renderList();
        // Optional: stopAmbient(); 
    }, 300);
  }

  // --- DRAWING ENGINE ---
  function initCanvas() {
    ctx = canvas.getContext('2d');
    canvas.width = 800; canvas.height = 1760;
    ctx.lineJoin = 'round'; ctx.lineCap = 'round'; ctx.lineWidth = 3; ctx.strokeStyle = '#333';
  }

  function toggleDrawingMode() {
    isDrawingMode = !isDrawingMode;
    const btn = $('drawBtn');
    if(isDrawingMode) {
      $('paperContainer').classList.add('drawing-active');
      $('richEditor').contentEditable = false;
      btn.classList.add('draw-active');
      // Disable text mode if active
      if(!isArrangeMode) toggleEditMode(); 
    } else {
      $('paperContainer').classList.remove('drawing-active');
      $('richEditor').contentEditable = true;
      btn.classList.remove('draw-active');
      autoSave();
    }
  }

  function startDraw(e) {
    if(!isDrawingMode) return;
    isDrawing = true;
    const pos = getPos(e);
    lastX = pos.x; lastY = pos.y;
  }

  function draw(e) {
    if(!isDrawing || !isDrawingMode) return;
    e.preventDefault();
    const pos = getPos(e);
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
    lastX = pos.x; lastY = pos.y;
  }

  function stopDraw() { 
    if(isDrawing) { isDrawing = false; autoSave(); }
  }

  function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return {
      x: (clientX - rect.left) * (canvas.width / rect.width),
      y: (clientY - rect.top) * (canvas.height / rect.height)
    };
  }

  function clearCanvas() { ctx.clearRect(0,0,canvas.width,canvas.height); }
  
  function loadCanvas(dataUrl) {
    const img = new Image();
    img.onload = () => ctx.drawImage(img, 0, 0);
    img.src = dataUrl;
  }

  // --- LOCK & PIN SYSTEM ---
  function openPinModal() {
    $('pinModal').classList.add('active');
    currentPin = "";
    updatePinDisplay();
  }
  function closePinModal() { $('pinModal').classList.remove('active'); }
  function typePin(n) {
    if(currentPin.length < 4) { 
      currentPin += n; 
      updatePinDisplay(); 
      $('sfxClick').play().catch(()=>{});
    }
  }
  function clearPin() { currentPin = ""; updatePinDisplay(); }
  function updatePinDisplay() { $('pinDisplay').innerText = "*".repeat(currentPin.length); }
  
  function submitPin() {
    if(currentPin.length !== 4) return;
    
    if(tempPinAction === 'open') {
      const note = notes.find(n => n.id === targetNoteId);
      if(note && note.pin === currentPin) {
        closePinModal();
        openNote(note);
      } else {
        alert('PIN Salah!'); clearPin();
      }
    } else if (tempPinAction === 'lock') {
      currentNote.isLocked = true;
      currentNote.pin = currentPin;
      autoSave();
      closePinModal();
      alert('Catatan berhasil dikunci!');
      closePanel(); // Close settings panel
    }
  }

  function lockCurrentNote() {
    if(currentNote.isLocked) {
      if(confirm("Buka kunci catatan ini?")) {
        currentNote.isLocked = false;
        currentNote.pin = null;
        autoSave();
        alert("Catatan tidak terkunci lagi.");
        closePanel();
      }
    } else {
      tempPinAction = 'lock';
      $('pinTitle').innerText = "Buat PIN Baru";
      openPinModal();
    }
  }

  // --- AMBIENT SOUND ---
  function playAmbient(type) {
    stopAmbient();
    const id = type === 'rain' ? 'bgmRain' : type === 'lofi' ? 'bgmLofi' : 'bgmForest';
    activeAudio = $(id);
    activeAudio.volume = 0.5;
    activeAudio.play().catch(e => alert("Tap layar dulu untuk memutar musik"));
    $('ambientToggle').classList.add('active');
    $('ambientMenu').classList.add('hidden');
  }

  function stopAmbient() {
    if(activeAudio) { activeAudio.pause(); activeAudio.currentTime = 0; }
    $('ambientToggle').classList.remove('active');
    $('ambientMenu').classList.add('hidden');
  }

  // --- PAGE NAV ---
  function addNewPage() {
    autoSave();
    const nextPage = Object.keys(currentNote.pages).length + 1;
    currentNote.pages[nextPage] = { content: '', stickers: [], drawing: null };
    currentPage = nextPage;
    loadNoteData();
    autoSave();
  }
  
  function navigatePage(dir) {
    const total = Object.keys(currentNote.pages).length;
    if(dir === 'prev' && currentPage > 1) { autoSave(); currentPage--; loadNoteData(); }
    if(dir === 'next' && currentPage < total) { autoSave(); currentPage++; loadNoteData(); }
  }

  // --- OTHER LOGIC (Stickers, Text, etc) ---
  function toggleEditMode() {
    isArrangeMode = !isArrangeMode;
    const btn = $('modeBtn');
    if(isArrangeMode) {
      $('paperContainer').classList.add('arrange-mode');
      $('richEditor').contentEditable = false;
      btn.innerHTML = '<i class="fas fa-hand-pointer"></i>'; btn.classList.remove('active');
    } else {
      $('paperContainer').classList.remove('arrange-mode');
      $('richEditor').contentEditable = true;
      btn.innerHTML = '<i class="fas fa-pen"></i>'; btn.classList.add('active');
      if(isDrawingMode) toggleDrawingMode();
    }
  }

  function openPanel(tab) { $('megaPanel').classList.add('open'); $('overlay').classList.add('active'); renderPanel(tab); }
  function closePanel() { $('megaPanel').classList.remove('open'); $('overlay').classList.remove('active'); }

  function renderPanel(tab) {
    const content = $('panelContent');
    content.innerHTML = '';
    
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

    if(tab === 'stickers') {
      const div = document.createElement('div'); div.id = 'emojiContainer';
      content.appendChild(div);
      emojiPicker = picmo.createPicker({ rootElement: div, native: true });
      emojiPicker.addEventListener('emoji:select', s => { addSticker(s.emoji); closePanel(); });
    } 
    else if(tab === 'stickers2') {
      content.innerHTML = `
        <div class="custom-sticker-upload">
          <button class="upload-btn" onclick="document.getElementById('customStickerInput').click()"><i class="fas fa-upload"></i> Upload</button>
          <div class="upload-tips">Format: PNG / WEBP (Transparan)</div>
        </div>`;
      if (customStickers.length > 0) {
        const grid = document.createElement('div'); grid.className = 'custom-sticker-grid';
        customStickers.forEach(s => {
          const item = document.createElement('div'); item.className = 'custom-sticker-item';
          item.innerHTML = `<img src="${s.dataUrl}"><button class="delete-sticker-btn" onclick="deleteCustomSticker('${s.id}')">√ó</button>`;
          item.onclick = (e) => { if(!e.target.closest('.delete-sticker-btn')) { addSticker(null, true, s.dataUrl); closePanel(); }};
          grid.appendChild(item);
        });
        content.appendChild(grid);
      }
    }
    else if (tab === 'meta') {
      content.innerHTML = `
        <div class="tool-grid">
          <div class="tool-item" onclick="lockCurrentNote()"><i class="fas fa-lock"></i><span>${currentNote.isLocked ? 'Buka Kunci' : 'Kunci PIN'}</span></div>
          <div class="tool-item" onclick="setTag('Penting')"><i class="fas fa-circle" style="color:#ff6b6b"></i><span>Penting</span></div>
          <div class="tool-item" onclick="setTag('Ide')"><i class="fas fa-circle" style="color:#54a0ff"></i><span>Ide</span></div>
          <div class="tool-item" onclick="setTag('Jurnal')"><i class="fas fa-circle" style="color:#1dd1a1"></i><span>Jurnal</span></div>
        </div>
      `;
    } 
    else if (tab === 'style') {
        const fonts = ['Quicksand', 'Caveat', 'Kalam', 'Sacramento'];
        let h = `<div class="tool-grid">`;
        fonts.forEach(f => h += `<div class="tool-item" onclick="document.execCommand('fontName',false,'${f}'); closePanel();" style="font-family:${f}">Aa<br><span>${f}</span></div>`);
        h += `</div>`;
        content.innerHTML = h;
    } 
    else if (tab === 'paper') {
       content.innerHTML = `
        <div class="tool-grid">
          <div class="tool-item" onclick="applyPaper('lines')"><i class="fas fa-bars"></i><span>Garis</span></div>
          <div class="tool-item" onclick="applyPaper('grid')"><i class="fas fa-border-all"></i><span>Kotak</span></div>
          <div class="tool-item" onclick="applyPaper('plain')"><i class="far fa-file"></i><span>Polos</span></div>
        </div>`;
    }
  }

  function setTag(tag) {
    currentNote.tag = tag;
    autoSave();
    alert('Tag diset: ' + tag);
    closePanel();
  }

  function applyPaper(type) {
    currentNote.paper = type;
    const c = currentNote.theme === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)';
    let bg = '';
    if(type === 'lines') bg = `repeating-linear-gradient(transparent, transparent 31px, ${c} 31px, ${c} 32px)`;
    if(type === 'grid') bg = `linear-gradient(${c} 1px, transparent 1px), linear-gradient(90deg, ${c} 1px, transparent 1px)`;
    $('paperPattern').style.backgroundImage = bg;
    $('paperPattern').style.backgroundSize = type === 'grid' ? '20px 20px' : '100% 32px';
    autoSave(); closePanel();
  }
  
  function applyTheme(id) {
    $('paperContainer').style.backgroundColor = id === 'dark' ? '#222' : '#fffaf0';
    $('richEditor').style.color = id === 'dark' ? '#eee' : '#333';
  }

  // --- STICKER FUNCTIONS ---
  function addSticker(emoji, isCustom, url) {
    const s = { id:'s'+Date.now(), emoji, x:100, y:100, rot:0, scale:1.5, layer:'front', page:currentPage, isCustom, customDataUrl:url };
    if(!currentNote.pages[currentPage].stickers) currentNote.pages[currentPage].stickers = [];
    currentNote.pages[currentPage].stickers.push(s);
    renderSticker(s); autoSave();
  }

  function renderSticker(d) {
    const el = document.createElement('div'); el.className='sticker'; el.id=d.id;
    el.style.left=d.x+'px'; el.style.top=d.y+'px';
    el.style.transform=`rotate(${d.rot}deg) scale(${d.scale})`;
    el.dataset.layer = d.layer;
    el.innerHTML = d.isCustom ? `<img src="${d.customDataUrl}" style="width:60px;">` : `<div style="font-size:40px;">${d.emoji}</div>`;
    
    const c = document.createElement('div'); c.className = 'sticker-controls';
    c.innerHTML = `<div class="ctrl-btn ctrl-del" onclick="deleteSticker(event,'${d.id}')">√ó</div>
                   <div class="ctrl-btn ctrl-move"><i class="fas fa-arrows-alt"></i></div>
                   <div class="ctrl-rotate"><i class="fas fa-sync"></i></div>`;
    el.appendChild(c);

    (d.layer === 'back' ? $('stickerLayerBack') : $('stickerLayerFront')).appendChild(el);
    attachStickerEvents(el);
  }

  function deleteSticker(e, id) {
    e.stopPropagation();
    $(id).remove();
    const arr = currentNote.pages[currentPage].stickers;
    currentNote.pages[currentPage].stickers = arr.filter(s => s.id !== id);
    autoSave();
  }

  function attachStickerEvents(el) {
    el.addEventListener('mousedown', () => {
      if(selectedSticker) selectedSticker.classList.remove('selected');
      selectedSticker = el; el.classList.add('selected');
    });

    const moveBtn = el.querySelector('.ctrl-move');
    moveBtn.addEventListener('mousedown', (e) => {
      e.stopPropagation();
      const move = (ev) => {
        const rect = $('paperContainer').getBoundingClientRect();
        el.style.left = (ev.clientX - rect.left - 20) + 'px';
        el.style.top = (ev.clientY - rect.top - 20) + 'px';
      };
      const stop = () => { document.removeEventListener('mousemove', move); autoSaveStickers(); };
      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', stop, {once:true});
    });

    const rotBtn = el.querySelector('.ctrl-rotate');
    rotBtn.addEventListener('mousedown', (e) => {
      e.stopPropagation();
      const rect = el.getBoundingClientRect();
      const cx = rect.left + rect.width/2; const cy = rect.top + rect.height/2;
      const rotate = (ev) => {
        const angle = Math.atan2(ev.clientY - cy, ev.clientX - cx) * (180/Math.PI) + 90;
        el.style.transform = `rotate(${angle}deg) scale(1.5)`;
      };
      const stop = () => { document.removeEventListener('mousemove', rotate); autoSaveStickers(); };
      document.addEventListener('mousemove', rotate);
      document.addEventListener('mouseup', stop, {once:true});
    });
  }

  function autoSaveStickers() {
     currentNote.pages[currentPage].stickers = getStickersData();
     autoSave();
  }

  function getStickersData() {
    const arr = [];
    ['stickerLayerBack', 'stickerLayerFront'].forEach(l => {
        Array.from($(l).children).forEach(el => {
            const img = el.querySelector('img');
            const isCustom = !!img;
            arr.push({
                id: el.id,
                emoji: isCustom ? null : el.innerText.trim(),
                isCustom,
                customDataUrl: isCustom ? img.src : null,
                x: parseFloat(el.style.left),
                y: parseFloat(el.style.top),
                rot: 0, scale: 1.5,
                layer: l.includes('Back') ? 'back' : 'front'
            });
        });
    });
    return arr;
  }
  
  function deleteNote(id, e) {
    e.stopPropagation();
    if(confirm("Hapus catatan ini?")) {
        notes = notes.filter(n => n.id !== id);
        localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
        renderList();
    }
  }

  // --- CUSTOM UPLOAD & IMPORT ---
  function handleCustomStickerUpload(e) {
    const file = e.target.files[0];
    if(!file) return;
    const r = new FileReader();
    r.onload = (ev) => {
      customStickers.push({id:'c'+Date.now(), dataUrl:ev.target.result});
      localStorage.setItem(STICKER_KEY, JSON.stringify(customStickers));
      renderPanel('stickers2');
    };
    r.readAsDataURL(file);
  }

  function deleteCustomSticker(id) {
    customStickers = customStickers.filter(s => s.id !== id);
    localStorage.setItem(STICKER_KEY, JSON.stringify(customStickers));
    renderPanel('stickers2');
  }

  function showExportDialog(type) {
    const data = type === 'single' ? {note: currentNote} : {notes: notes};
    const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'zeli_backup.json';
    a.click();
  }

  function importNotes(e) {
    const reader = new FileReader();
    reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          if(confirm("Gabungkan data (OK) atau Timpa (Cancel)?")) {
              const incoming = data.notes || [data.note];
              const ids = new Set(notes.map(n=>n.id));
              incoming.forEach(n => { if(!ids.has(n.id)) notes.push(n); });
          } else {
              notes = data.notes || [data.note];
          }
          localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
          renderList();
          alert("Import Selesai!");
        } catch(err) { alert("File error"); }
    };
    reader.readAsText(e.target.files[0]);
  }
  
  // Basic Text Tools
  function execCmd(c,v){ document.execCommand(c,false,v); }
  function saveSelection(){} 
  function insertCheckbox() { execCmd('insertHTML', '<input type="checkbox"> '); }
  function insertImagePrompt() {
    const i = document.createElement('input'); i.type='file'; i.accept='image/*';
    i.onchange=e=>{
      const r = new FileReader();
      r.onload=ev=>execCmd('insertHTML', `<img src="${ev.target.result}" style="max-width:300px;border-radius:10px;">`);
      r.readAsDataURL(e.target.files[0]);
    };
    i.click();
  }
</script>
</body>
</html>
